import{b as u,o as R}from"../chunks/C8st8IW6.js";import"../chunks/Bzak7iHL.js";import{p as A,e as y,g as I,i as n,u as L,b as O,f as j,d as k,s as v,t as x,a as F,h as i,m as $,j as N}from"../chunks/jB7C_rnE.js";import{h as T}from"../chunks/Caj0Wir2.js";import{b as d}from"../chunks/CgC7qgJv.js";import{s as q,a as z}from"../chunks/D-VCVtW5.js";import{p as r}from"../chunks/U6mOqqCz.js";import{g as B,r as C}from"../chunks/Bh8BaerV.js";import{u as G}from"../chunks/DJ2Os-o7.js";import{C as J,p as Q,f as W}from"../chunks/DaIARzQE.js";import{u as D}from"../chunks/DSumOSA1.js";import{e as P,E as H}from"../chunks/ucWAtqEP.js";import{l as K,s as M}from"../chunks/DJ7kQp0g.js";async function V({params:m,parent:s,fetch:f}){return await f(`${u}/api/v2/models/${m.model}/subscribe`,{method:"POST"}),{settings:await s().then(g=>({...g.settings,activeModel:m.model}))}}const pt=Object.freeze(Object.defineProperty({__proto__:null,load:V},Symbol.toStringTag,{value:"Module"}));var X=j('<meta property="og:title"/> <meta property="og:type" content="link"/> <meta property="og:description"/> <meta property="og:image"/> <meta property="og:url"/> <meta name="twitter:card" content="summary_large_image"/>',1);function dt(m,s){A(s,!0);const f=()=>z(b,"$settings",g),[g,U]=q();let h=y(!1),c=y(I([])),p=y("");const b=D(),o=r.params.model,_=G();async function w(a){try{i(h,!0);const t=await fetch(`${u}/conversation`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:o,preprompt:f().customPrompts[o]})});if(!t.ok){P.set("Error while creating conversation, try again."),console.error("Error while creating conversation: "+await t.text());return}const{conversationId:e}=await t.json();Q.set({content:a,files:n(c)}),await B(`${u}/conversation/${e}`,{invalidateAll:!0})}catch(t){P.set(H.default),console.error(t)}finally{i(h,!1)}}R(async()=>{try{if(r.url.searchParams.has("attachments")){const e=await K(r.url.searchParams);i(c,e.files,!0),e.errors.length>0&&(console.error("Failed to load some attachments:",e.errors),P.set(`Failed to load ${e.errors.length} attachment(s). Check console for details.`));const l=new URL(r.url);l.searchParams.delete("attachments"),history.replaceState({},"",l)}const a=M(r.url.searchParams.get("q"));if(a){w(a);const e=new URL(r.url);e.searchParams.delete("q"),$().then(()=>{C(e,r.state)});return}const t=M(r.url.searchParams.get("prompt"));if(t&&!n(p)){i(p,t,!0);const e=new URL(r.url);e.searchParams.delete("prompt"),$().then(()=>{C(e,r.state)})}}catch(a){console.error("Failed to process URL parameters:",a)}b.instantSet({activeModel:o})}),T("1d34z81",a=>{var t=X(),e=k(t),l=v(e,4),S=v(l,2),E=v(S,2);N(2),x(()=>{d(e,"content",o+" - "+_.PUBLIC_APP_NAME),d(l,"content",`Use ${o} with ${_.PUBLIC_APP_NAME}`),d(S,"content",`${(_.PUBLIC_ORIGIN||r.url.origin)??""}${u??""}/models/${o??""}/thumbnail.png`),d(E,"content",r.url.href)}),F(a,t)});{let a=L(()=>W(s.data.models,s.data.oldModels,o));J(m,{onmessage:t=>w(t),get loading(){return n(h)},get currentModel(){return n(a)},get models(){return s.data.models},get files(){return n(c)},set files(t){i(c,t,!0)},get draft(){return n(p)},set draft(t){i(p,t,!0)}})}O(),U()}export{dt as component,pt as universal};
