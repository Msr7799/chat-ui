import"../chunks/Bzak7iHL.js";import{o as q,b as v}from"../chunks/C8st8IW6.js";import{p as B,e as y,g as T,k as $,d as z,a as _,b as G,l as H,h as m,m as M,i as n,$ as J,u as P,f as Q}from"../chunks/jB7C_rnE.js";import{i as W}from"../chunks/Bp5l5fH2.js";import{h as D}from"../chunks/Caj0Wir2.js";import{s as K,b,a as w}from"../chunks/D-VCVtW5.js";import{r as x,g as V}from"../chunks/Bh8BaerV.js";import{p as r}from"../chunks/U6mOqqCz.js";import{u as X}from"../chunks/DJ2Os-o7.js";import{p as Y,C as Z,f as ee}from"../chunks/DaIARzQE.js";import{e as u,E as S}from"../chunks/ucWAtqEP.js";import{u as te}from"../chunks/DSumOSA1.js";import{l as ae,s as C}from"../chunks/DJ7kQp0g.js";import{l as f}from"../chunks/MDZlMq7w.js";var re=Q('<div class="mx-auto my-20 max-w-xl rounded-xl border p-6 text-center dark:border-gray-700"><h2 class="mb-2 text-xl font-semibold">No models available</h2> <p class="text-gray-600 dark:text-gray-300">No chat models are configured. Set `OPENAI_BASE_URL` and ensure the server can reach the\n			endpoint, then reload. If unset, the app defaults to the Hugging Face router.</p></div>');function ye(E,s){B(s,!0);const R=()=>w(f,"$loading",h),l=()=>w(L,"$settings",h),[h,U]=K(),k=X();let A=P(()=>{var e;return!!((e=s.data.models)!=null&&e.length)}),i=y(T([])),d=y("");const L=te();async function g(e){try{b(f,!0);const t=s.data.models.map(c=>c.id);let a;t.includes(l().activeModel)?a=l().activeModel:a=s.data.models[0].id;const o=await fetch(`${v}/conversation`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:a,preprompt:l().customPrompts[l().activeModel]})});if(!o.ok){const c=(await o.json()).message||S.default;u.set(c),console.error("Error while creating conversation: ",c);return}const{conversationId:j}=await o.json();Y.set({content:e,files:n(i)}),await V(`${v}/conversation/${j}`,{invalidateAll:!0})}catch(t){u.set(t.message||S.default),console.error(t)}finally{b(f,!1)}}q(async()=>{try{if(r.url.searchParams.has("attachments")){const a=await ae(r.url.searchParams);m(i,a.files,!0),a.errors.length>0&&(console.error("Failed to load some attachments:",a.errors),u.set(`Failed to load ${a.errors.length} attachment(s). Check console for details.`));const o=new URL(r.url);o.searchParams.delete("attachments"),history.replaceState({},"",o)}const e=C(r.url.searchParams.get("q"));if(e){g(e);const a=new URL(r.url);a.searchParams.delete("q"),M().then(()=>{x(a,r.state)});return}const t=C(r.url.searchParams.get("prompt"));if(t&&!n(d)){m(d,t,!0);const a=new URL(r.url);a.searchParams.delete("prompt"),M().then(()=>{x(a,r.state)})}}catch(e){console.error("Failed to process URL parameters:",e)}});let F=P(()=>ee(s.data.models,s.data.oldModels,l().activeModel));var p=$();D("1uha8ag",e=>{H(()=>{J.title=k.PUBLIC_APP_NAME??""})});var N=z(p);{var I=e=>{Z(e,{onmessage:t=>g(t),get loading(){return R()},get currentModel(){return n(F)},get models(){return s.data.models},get files(){return n(i)},set files(t){m(i,t,!0)},get draft(){return n(d)},set draft(t){m(d,t,!0)}})},O=e=>{var t=re();_(e,t)};W(N,e=>{n(A)?e(I):e(O,!1)})}_(E,p),G(),U()}export{ye as component};
