import{u as De,h as Pe}from"../chunks/DkC0pIUA.js";import{U as Fe,u as Re}from"../chunks/DSumOSA1.js";import{r as Oe}from"../chunks/Cb9P7DQp.js";import"../chunks/Bzak7iHL.js";import{d as Ge,o as We,e as je,b as ce}from"../chunks/C8st8IW6.js";import{f as we,s as te,c as fe,r as ge,a as ve,p as He,e as O,g as J,M as j,h as A,i as n,u as H,d as Ve,b as qe,l as Be,ao as Ke,$ as ze}from"../chunks/jB7C_rnE.js";import{i as Le}from"../chunks/Bp5l5fH2.js";import{h as Ne}from"../chunks/Caj0Wir2.js";import{p as Ye,b as l,s as Ze,a as G}from"../chunks/D-VCVtW5.js";import{C as Je,p as ue,f as Qe,b as Xe,c as et,u as tt}from"../chunks/DaIARzQE.js";import{M as v,a as Q,i as W,r as st,e as at}from"../chunks/DQtvdNTz.js";import{p as x}from"../chunks/U6mOqqCz.js";import{b as rt,c as nt}from"../chunks/Bh8BaerV.js";import{e as E,E as me}from"../chunks/ucWAtqEP.js";import{r as ot,a as pe,t as it}from"../chunks/DjZjxwXe.js";import{b as he}from"../chunks/Bh8KIsK8.js";import{M as lt}from"../chunks/CpzPGquC.js";import{l as _}from"../chunks/MDZlMq7w.js";const dt=async({params:s,depends:r,fetch:h,url:o})=>{r(Fe.Conversation);const y=De({fetch:h,origin:o.origin});try{return await y.conversations({id:s.id}).get({query:{fromShare:o.searchParams.get("fromShare")??void 0}}).then(Pe)}catch{Oe(302,"/")}},Ft=Object.freeze(Object.defineProperty({__proto__:null,load:dt},Symbol.toStringTag,{value:"Module"}));var p=[];for(var X=0;X<256;++X)p.push((X+256).toString(16).slice(1));function ct(s,r=0){return(p[s[r+0]]+p[s[r+1]]+p[s[r+2]]+p[s[r+3]]+"-"+p[s[r+4]]+p[s[r+5]]+"-"+p[s[r+6]]+p[s[r+7]]+"-"+p[s[r+8]]+p[s[r+9]]+"-"+p[s[r+10]]+p[s[r+11]]+p[s[r+12]]+p[s[r+13]]+p[s[r+14]]+p[s[r+15]]).toLowerCase()}var V,ft=new Uint8Array(16);function gt(){if(!V&&(V=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!V))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return V(ft)}var ut=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const ye={randomUUID:ut};function se(s,r,h){if(ye.randomUUID&&!s)return ye.randomUUID();s=s||{};var o=s.random||(s.rng||gt)();return o[6]=o[6]&15|64,o[8]=o[8]&63|128,ct(o)}function ee(s,r,h){var M;if(s.messages.length===0){const f=se();return s.rootMessageId=f,s.messages.push({...r,ancestors:[],id:f}),f}if(!h)throw new Error("You need to specify a parentId if this is not the first message");const o=se();if(!s.rootMessageId){if(h&&h!==s.messages[s.messages.length-1].id)throw new Error("This is a legacy conversation, you can only append to the last message");return s.messages.push({...r,id:o}),o}const y=[...((M=s.messages.find(f=>f.id===h))==null?void 0:M.ancestors)??[],h];s.messages.push({...r,ancestors:y,id:o,children:[]});const k=s.messages.find(f=>f.id===h);return k&&(k.children?k.children.push(o):k.children=[o]),o}function be(s,r,h){var f;if(s.messages.length===0)throw new Error("Cannot add a sibling to an empty conversation");if(!s.rootMessageId)throw new Error("Cannot add a sibling to a legacy conversation");const o=s.messages.find(C=>C.id===h);if(!o)throw new Error("The sibling message doesn't exist");if(!o.ancestors||((f=o.ancestors)==null?void 0:f.length)===0)throw new Error("The sibling message is the root message, therefore we can't add a sibling");const y=se();s.messages.push({...r,id:y,ancestors:o.ancestors,children:[]});const k=o.ancestors[o.ancestors.length-1],M=s.messages.find(C=>C.id===k);return M&&(M.children?M.children.push(y):M.children=[y]),y}var mt=we(`<div class="flex w-full flex-col gap-8 bg-white bg-gradient-to-b to-transparent px-6 pb-7 dark:bg-black dark:from-white/10 dark:to-white/5"><div class="-mx-6 grid h-48 select-none place-items-center bg-gradient-to-t from-black/5 dark:from-white/10"><div class="flex flex-col items-center justify-center gap-2.5 px-8 text-center"><div class="flex size-14 items-center justify-center rounded-full bg-gradient-to-br from-pink-500/15 from-15% via-green-500/15 to-yellow-500/15 text-3xl"><svg width="1em" height="1em" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.48 1.26001C6.48 2.81001 7.15 3.84001 7.98 4.50001C8.84 5.18001 9.88 5.50001 10.56 5.57001V6.43001C9.6233 6.5513 8.73602 6.92071 7.99 7.50001C7.50131 7.88332 7.10989 8.37647 6.84753 8.93943C6.58516 9.50238 6.45925 10.1193 6.48 10.74H5.52C5.52 9.19001 4.85 8.16001 4.02 7.50001C3.27114 6.91907 2.3802 6.54958 1.44 6.43001V5.57001C2.37671 5.44872 3.26398 5.07931 4.01 4.50001C4.4987 4.1167 4.89011 3.62355 5.15248 3.06059C5.41484 2.49764 5.54076 1.88075 5.52 1.26001H6.48Z" fill="url(#paint0_linear_141_2)"></path><defs><linearGradient id="paint0_linear_141_2" x1="3.37" y1="3.43001" x2="8.14" y2="8.90001" gradientUnits="userSpaceOnUse"><stop stop-color="#FF0789"></stop><stop offset="0.63" stop-color="#21DE75"></stop><stop offset="1" stop-color="#FF8D00"></stop></linearGradient></defs></svg></div> <h2 class="text-2xl font-semibold text-gray-900 dark:text-gray-100">Upgrade Required</h2></div></div> <div class="text-gray-700 dark:text-gray-200"><p class="text-[15px] leading-relaxed">You've reached your message limit. Upgrade to Hugging Face PRO to continue using
				HuggingChat.</p> <p class="mt-3 text-[15px] italic leading-relaxed opacity-75">It's also possible to use your PRO credits in your favorite AI tools.</p></div> <div class="flex flex-col gap-2.5"><a href="https://huggingface.co/subscribe/pro?from=HuggingChat" target="_blank" rel="noopener noreferrer" class="w-full rounded-xl bg-black px-5 py-2.5 text-center text-base font-medium text-white hover:bg-gray-800 dark:bg-white dark:text-black dark:hover:bg-gray-200">Upgrade to Pro</a> <button class="w-full rounded-xl bg-gray-200 px-5 py-2.5 text-base font-medium text-gray-700 hover:bg-gray-300/80 dark:bg-white/5 dark:text-gray-200 dark:hover:bg-white/10">Maybe later</button></div></div>`);function pt(s,r){lt(s,{closeOnBackdrop:!1,get onclose(){return r.close},width:"!max-w-[420px] !m-4",children:(h,o)=>{var y=mt(),k=te(fe(y),4),M=te(fe(k),2);M.__click=function(...f){var C;(C=r.close)==null||C.apply(this,f)},ge(k),ge(y),ve(h,y)},$$slots:{default:!0}})}Ge(["click"]);var ht=we("<!> <!>",1);function Rt(s,r){He(r,!0);const h=()=>G(W,"$isAborted",f),o=()=>G(_,"$loading",f),y=()=>G(at,"$enabledServers",f),k=()=>G(Ae,"$settings",f),M=()=>G(ue,"$pendingMessage",f),[f,C]=Ze();let d=Ye(r,"data",15),F=O(!1),ae=!0,q=O(!1),R=O(J([])),B=O(J(d().conversations));j(()=>{A(B,d().conversations,!0)});function K(t,a){ae&&(!a&&x.url.searchParams.get("leafId")&&(a=x.url.searchParams.get("leafId"),x.url.searchParams.delete("leafId")),!a&&he&&localStorage.getItem("leafId")&&(a=localStorage.getItem("leafId")),ae=!1);const g=t.find(m=>m.id===a)??t.at(-1);if(!g)return[];const{ancestors:w}=g,S=[];if(w!=null&&w.length)for(const m of w){const I=t.find(i=>i.id===m);I&&S.push(I)}S.push(g);let c=g.children;for(;c!=null&&c.length;){let m=c.at(-1);const I=t.find(i=>i.id===m);I&&S.push(I),c=I==null?void 0:I.children}return S}function xe(t){var g;const a=[];for(const w of t)(g=w.children)!=null&&g.length&&a.push(w.children);return a}async function z({prompt:t,messageId:a=(w=>(w=n(T).at(-1))==null?void 0:w.id)()??void 0,isRetry:g=!1}){var S;try{l(W,!1),l(_,!0),A(F,!0);const c=await Promise.all((n(R)??[]).map(e=>Xe(e).then(P=>({type:"base64",value:P,mime:e.type,name:e.name}))));let m;if(g&&a){const e=n(b).find(P=>P.id===a);if(e||l(E,"Message not found"),(e==null?void 0:e.from)==="user"&&t){const P=be({messages:n(b),rootMessageId:d().rootMessageId},{from:"user",content:t,files:e.files},a);m=ee({messages:n(b),rootMessageId:d().rootMessageId},{from:"assistant",content:""},P)}else(e==null?void 0:e.from)==="assistant"&&(m=be({messages:n(b),rootMessageId:d().rootMessageId},{from:"assistant",content:""},a))}else{const e=ee({messages:n(b),rootMessageId:d().rootMessageId},{from:"user",content:t??"",files:c},a);d().rootMessageId||d(d().rootMessageId=e,!0),m=ee({messages:n(b),rootMessageId:d().rootMessageId},{from:"assistant",content:""},e)}const I=n(b).find(e=>e.id===a),i=n(b).find(e=>e.id===m);if(!i)throw new Error("Message to write to not found");const le=new AbortController,de=await et(x.params.id,{base:ce,inputs:t,messageId:a,isRetry:g,files:g?I==null?void 0:I.files:c,selectedMcpServerNames:y().map(e=>e.name),selectedMcpServers:y().map(e=>({name:e.name,url:e.url,headers:e.headers}))},le.signal).catch(e=>{E.set(e.message)});if(de===void 0)return;A(R,[],!0);let D="",L=new Date;for await(const e of de){if(h()){le.abort();return}if(e.type===v.Stream&&(e.token=e.token.replaceAll("\0","")),!(e.type===v.Status&&e.status===Q.KeepAlive))if(e.type===v.Stream){const $=i.updates??[],u=$.at(-1);if((u==null?void 0:u.type)===v.Stream){const U={...u,token:(u.token??"")+(e.token??"")};i.updates=[...$.slice(0,-1),U]}else i.updates=[...$,e]}else i.updates=[...i.updates??[],e];const N=new Date;if(e.type!==v.Stream&&!k().disableStream&&D.length>0&&(i.content+=D,D="",L=N),e.type===v.Stream&&!k().disableStream)D+=e.token,N.getTime()-L.getTime()>tt.maxUpdateTime&&(i.content+=D,D="",L=N),A(F,!1);else if(e.type===v.FinalAnswer)if(((S=i.updates)==null?void 0:S.some(u=>u.type===v.Tool))??!1){const u=i.content,U=e.text??"",Y=u.replace(/\s+$/,""),Z=U.replace(/^\s+/,""),Ee=U&&(u.endsWith(U)||Z.length>0&&Y.endsWith(Z));if(u&&u.length>0)if(Ee)i.content=u;else if(U&&(U.startsWith(u)||Y.length>0&&Z.startsWith(Y)))i.content=U;else{const Te=!/\n\n$/.test(u)&&!/^\n/.test(U??"");i.content=u+(Te?`

`:"")+U}else i.content=U}else i.content=e.text??"";else if(e.type===v.Status&&e.status===Q.Error)e.statusCode===402?A(q,!0):l(E,e.message??"An error has occurred");else if(e.type===v.Title){const $=n(B).find(({id:u})=>u===x.params.id);$&&($.title=e.title,l(it,{title:e.title,convId:x.params.id}))}else e.type===v.File?i.files=[...i.files??[],{type:"hash",value:e.sha,mime:e.mime,name:e.name}]:e.type===v.RouterMetadata&&(i.routerMetadata={route:e.route,model:e.model})}}catch(c){c instanceof Error&&c.message.includes("overloaded")?l(E,"Too much traffic, please try again."):c instanceof Error&&c.message.includes("429")?l(E,me.rateLimited):c instanceof Error?l(E,c.message):l(E,me.default),console.error(c)}finally{l(_,!1),A(F,!1),await nt()}}async function re(){await fetch(`${ce}/conversation/${x.params.id}/stop-generating`,{method:"POST"}).then(t=>{t.ok?setTimeout(()=>{l(W,!0),l(_,!1)},500):(l(W,!0),l(_,!1))})}function Me(t){t.key==="Escape"&&o()&&(t.preventDefault(),re())}We(async()=>{M()&&(A(R,M().files,!0),await z({prompt:M().content}),l(ue,void 0)),ne(n(b))&&(pe({id:x.params.id,startedAt:Date.now()}),l(_,!0))});async function Se(t){await z({prompt:t})}async function ke(t){if(st())return;const a=t.id;A(T,K(n(b),a)),await z({prompt:t.content,messageId:t.id,isRetry:!0})}async function Ie(t){const a=t.id;A(T,K(n(b),a))}const Ae=Re();let b=O(J(d().messages));j(()=>{A(b,d().messages,!0)});function ne(t){var S,c;const a=[...t].reverse().find(m=>m.from==="assistant");if(!a)return!1;const g=((S=a.updates)==null?void 0:S.some(m=>m.type===v.FinalAnswer))??!1,w=((c=a.updates)==null?void 0:c.some(m=>m.type===v.Status&&m.status===Q.Error))??!1;return!g&&!w}j(()=>{const t=ne(n(b));t?l(_,!0):n(F)||l(_,!1),!t&&he&&ot(x.params.id)});let T=H(()=>K(n(b))),Ue=H(()=>xe(n(b)));j(()=>{var t,a;(t=n(T).at(-1))!=null&&t.id&&localStorage.setItem("leafId",(a=n(T).at(-1))==null?void 0:a.id)}),rt(t=>{var g,w,S;if(!x.params.id)return;const a=((g=t.to)==null?void 0:g.route.id)!==x.route.id||((S=(w=t.to)==null?void 0:w.params)==null?void 0:S.id)!==x.params.id;o()&&a&&pe({id:x.params.id,startedAt:Date.now()}),l(W,!0),l(_,!1)});let _e=H(()=>{var a;const t=((a=n(B).find(g=>g.id===x.params.id))==null?void 0:a.title)??d().title;return t&&t.charAt(0).toUpperCase()+t.slice(1)});var oe=ht();je("keydown",Ke,Me),Ne("1djqiyk",t=>{Be(()=>{ze.title=n(_e)??""})});var ie=Ve(oe);{let t=H(()=>Qe(d().models,d().oldModels,d().model));Je(ie,{get loading(){return o()},get pending(){return n(F)},get messages(){return n(T)},get messagesAlternatives(){return n(Ue)},get shared(){return d().shared},get preprompt(){return d().preprompt},onmessage:Se,onretry:ke,onshowAlternateMsg:Ie,onstop:re,get models(){return d().models},get currentModel(){return n(t)},get files(){return n(R)},set files(a){A(R,a,!0)}})}var Ce=te(ie,2);{var $e=t=>{pt(t,{close:()=>A(q,!1)})};Le(Ce,t=>{n(q)&&t($e)})}ve(s,oe),qe(),C()}export{Rt as component,Ft as universal};
